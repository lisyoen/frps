# Network Ports Configuration

## 라우터 포트 포워딩 정책

**라우터**: ASUS RT-AX53U  
**공인 IP**: 110.13.119.7  
**miniPC 내부 IP**: 192.168.50.196

### 포트 포워딩 허용 범위
- **TCP**: 8000 ~ 8999 (1000개 포트)
- **UDP**: 8000 ~ 8999 (1000개 포트)
- **제한 사항**: 1024 미만 포트(80, 443 등) 및 9000 이상 포트는 포워딩 불가

### 이유
공유기 설정에서 외부 접근 가능한 포트 범위를 8000~8999로 제한해둠.

---

## 현재 사용 중인 포트

### 프로덕션 서비스

| 포트 | 서비스 | 프로토콜 | 상태 | 용도 | 비고 |
|------|--------|---------|------|------|------|
| 8088 | Guacamole | TCP/HTTP | ✅ 사용 중 | 원격 데스크톱 웹 게이트웨이 | 회사에서 프록시 경유 접속 확인 |
| 8089 | HTTP Tunnel Server | TCP/HTTP | ✅ 사용 중 | LLM API HTTP 프록시 | Flask 기반, 172.21.113.31:4000로 터널링 |

### 테스트/개발 서비스

| 포트 | 서비스 | 프로토콜 | 상태 | 용도 | 비고 |
|------|--------|---------|------|------|------|
| 8000 | FRP Server (frps) | TCP | ✅ 사용 중 | FRP 제어 포트 | 회사 DPI에 의해 차단됨 |
| 8081 | FRP vhost HTTP | TCP/HTTP | ⏸️ 대기 | FRP HTTP 프록시 | FRP 프로토콜 차단으로 미사용 |
| 8500 | TCP Echo Server | TCP | ⏸️ 대기 | 네트워크 테스트용 | Python 에코 서버, 필요 시 재실행 |

### 예약/계획된 포트

| 포트 범위 | 예약 용도 | 비고 |
|----------|----------|------|
| 8090-8099 | 추가 HTTP 서비스 | 향후 확장용 |
| 8100-8199 | 개발 서버 | Node.js, Python 개발 서버 등 |
| 8200-8299 | 데이터베이스 접근 | PostgreSQL, MySQL 프록시 등 |
| 8300-8899 | 미할당 | 자유롭게 사용 가능 |
| 8900-8999 | 임시 테스트 | 일시적 용도 |

---

## 포트 포워딩 규칙 (라우터 설정)

### 현재 활성화된 규칙

```
외부 포트 → 내부 IP:포트 (프로토콜) - 용도
─────────────────────────────────────────────
8000 → 192.168.50.196:8000 (TCP) - FRP Server
8081 → 192.168.50.196:8081 (TCP) - FRP vhost HTTP
8088 → 192.168.50.196:8088 (TCP) - Guacamole
8089 → 192.168.50.196:8089 (TCP) - HTTP Tunnel Server ⚠️ 추가 필요
8500 → 192.168.50.196:8500 (TCP) - TCP Echo Server (테스트용)
```

### 추가 필요한 규칙

- [ ] **8089 포트 포워딩 추가** (HTTP Tunnel Server)
  - 외부: 8089
  - 내부: 192.168.50.196:8089
  - 프로토콜: TCP
  - 우선순위: **높음** (현재 사용 중)

---

## 회사 네트워크 제약사항

### 회사(Spark) → miniPC 연결 제약

**회사 프록시**: 30.30.30.27:8080

| 프로토콜 | 직접 연결 | 프록시 경유 | 비고 |
|---------|----------|------------|------|
| HTTP (80) | ❌ 차단 | ✅ 허용 | 표준 HTTP만 허용 |
| HTTPS (443) | ❌ 차단 | ✅ 허용 | SSL Inspection 있음 |
| 비표준 TCP | ❌ 차단 | ❌ 차단 | DPI로 프로토콜 감지 |
| FRP 프로토콜 | ❌ 차단 | ❌ 차단 | 핸드셰이크 패턴 차단 |
| UDP | ❌ 차단 | ❌ 차단 | 모든 외부 UDP 차단 |

**작동 확인:**
- ✅ `curl --proxy http://30.30.30.27:8080 http://110.13.119.7:8088` → 성공
- ✅ `curl --proxy http://30.30.30.27:8080 http://110.13.119.7:8089` → 테스트 필요
- ❌ `nc 110.13.119.7 8500` → 타임아웃 (직접 연결 차단)
- ❌ FRP client → FRP server → "session shutdown" (프로토콜 차단)

---

## 내부 서비스 포트 (회사 네트워크)

### 회사 LLM 서버
- **IP**: 172.21.113.31
- **포트**: 4000
- **프로토콜**: HTTP
- **접근**: 회사 내부에서만 접근 가능
- **용도**: Spark에서 LLM API 요청

### HTTP 터널 경로
```
Spark(회사) → 프록시(30.30.30.27:8080) 
  → 인터넷
  → miniPC(110.13.119.7:8089)
  → HTTP Tunnel Server(192.168.50.196:8089)
  → LLM(172.21.113.31:4000)
```

---

## 포트 관리 규칙

### 신규 포트 사용 시 체크리스트
1. [ ] 8000~8999 범위 내 포트인가?
2. [ ] 이미 사용 중인 포트가 아닌가? (`sudo ss -tlnp | grep :포트번호`)
3. [ ] 라우터 포트 포워딩 추가 필요한가?
4. [ ] 이 파일에 포트 정보 기록
5. [ ] Git 커밋 (`git add .github/network-ports.md`)

### 포트 충돌 해결
```bash
# 사용 중인 포트 확인
sudo ss -tlnp | grep ':8[0-9][0-9][0-9]'

# 특정 포트 사용 프로세스 확인
sudo lsof -i :포트번호

# 포트 범위 스캔
for port in {8000..8999}; do nc -z -v 110.13.119.7 $port 2>&1 | grep succeeded; done
```

---

## 버전 이력

- **2025-11-11**: 초기 생성
  - 포트 8000~8999 범위 정의
  - 현재 사용 중인 포트 정리
  - 회사 네트워크 제약사항 문서화
  - HTTP Tunnel Server 8089 추가
